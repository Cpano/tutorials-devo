<!--========================================CALENDAR ICON========================================-->
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style"
  onload="this.onload=null;this.rel='stylesheet'">

<link rel="stylesheet" href="https://cpano.github.io/tutorials-devo/public/css/TutorialsStyles.css">

<!--========================================HEADER========================================-->
<!-- CC01v0 -->
<section style="background-image:url(/a/devo/images/cc01-weblogic-hero-banner.jpg);" class="cc01 cc01v0  txtlight cpad">
  <div class="cc01w1 cwidth">

    <h1>Database Infrastructure</h1>
    <p>The Oracle Database Cloud Service offers autonomous and co-managed Oracle Database cloud solutions.
      Autonomous databases are preconfigured, fully-managed environments that are suitable for either transaction
      processing or for data warehouse workloads.</p>

    <div style="display: flex; color: white;">
      <p class="page__date" style="margin-right: 25px;"><strong><i class="fas fa-user fa-calendar-alt"
            aria-hidden="true"></i>
          Author: </strong>
        Malte Menkhoff
      </p>

      <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong>
        <time>December 1, 2021</time>
      </p>

    </div>

  </div>
</section>
<!-- /CC01v0 -->


<!-- F19v0 -->
<section class="f19 f19v0 cpad">
  <div class="f19w1 cwidth">
    <div class="f19w2 f19-2col">
      <div class="f19col f19side">
        <!-- S20v0 -->
        <section class="s20 s20v0 cpad" data-ocomid="s20" data-trackas="s20">
          <div class="s20w1 cwidth">
            <div class="col-w1">

              <h3>About Malte Menkhoff</h3>

              <!--Social Icons-->
              <div class="author__urls-wrapper" style="margin-bottom: 15px;">
                <ul class="author__urls social-icons">
                  <li>
                    <a href="https://github.com/kubemen" itemprop="sameAs" rel="nofollow noopener noreferrer"
                      target="_blank">
                      <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span>
                    </a>
                  </li>
                </ul>
              </div><br><br>
              <!-- End Social Icons-->
              <p>Malte is a passioned solution architect and is supporting customers in the DACH region in
                migrating to OCI.</p>

              <p><strong>More tutorials from this author: <br> </strong> <span class="tags">


                  <a class="animated-link tag2" href="/tutorials/deploy-apache-superset-with-mds-on-oci/">Deploy Apache
                    Superset
                    with
                    MySQL Database Service on Oracle Cloud Infrastructure</a><br>

                  <a class="animated-link tag2" href="/tutorials/oci-iac-framework/getting-started-with-oci-intro/"
                    oci-iac-framework="" tutorials="">Getting Started with Oracle Cloud
                    Infrastructure (OCI)</a><br>


                  <a class=" animated-link tag2" href="/tutorials/oci-iac-framework/" tutorials="">Oracle Cloud
                    Infrastructure IaC Framework Series</a><br>

                  <a class=" animated-link tag2"
                    href="/tutorials/oci-iac-framework/getting-started-with-oci-step-1-provider/" oci-iac-framework=""
                    tutorials="">Automating OCI with Terraform</a><br>

                  <a class=" animated-link tag2"
                    href="/tutorials/oci-iac-framework/getting-started-with-oci-step-2-base/" oci-iac-framework=""
                    tutorials="">Service Delivery Framework</a><br>

                  <a class=" animated-link tag2"
                    href="/tutorials/oci-iac-framework/getting-started-with-oci-step-3-database-infrastructure/"
                    oci-iac-framework="" tutorials="">Database Infrastructure</a><br>

                  <a class=" animated-link tag2"
                    href="/tutorials/oci-iac-framework/getting-started-with-oci-step-4-app-infrastructure/"
                    oci-iac-framework="" tutorials="">Application Infrastructure</a><br>

                  <a class=" animated-link tag2"
                    href="/tutorials/oci-iac-framework/getting-started-with-oci-step-5-workload-deployment/"
                    oci-iac-framework="" tutorials="">Workload Deployment</a><br>

                  <a class=" animated-link tag2"
                    href="/tutorials/oci-iac-framework/getting-started-with-oci-step-6-governance/"
                    oci-iac-framework="" tutorials="">Governance</a><br>


                </span>
              </p>

              <!--Tags-->
              <h3>Tags</h3>
              <p> <span class="tags">

                  <a class="animated-link tag" href="#">open-source</a>
                  <a class="animated-link tag" href="#">terraform</a>
                  <a class="animated-link tag" href="#">iac</a>
                  <a class="animated-link tag" href="#">devops</a>
                  <a class="animated-link tag" href="#">get-started</a>
                </span>
              </p>

              <h3></h3>
              <a href="https://developer.oracle.com/tutorials">
                <p class="page__date" style="margin-right: 25px;"><strong>
                    Back to tutorials
                  </strong>
                </p>
              </a>

            </div>
          </div>
        </section>
        <!-- /S20v0 -->
      </div>
      <!-- SET UP -->
      <main class="f19col f19main">
        <!-- cc01v0 -->

        <section class="cc01 cc01v0 cpad" id="link1">
          <div class="cc01w1 cwidth">

            <h2>Welcome!</h2>

            <h1 id="overview-of-the-oracle-database-cloud-service">Overview of the Oracle Database Cloud Service</h1>

            <figure class="aligncenter">
              <picture>
                <source srcset="https://cool.devo.build/tutorials/oci-iac-framework/assets/dbcs_overview.png 1x" />
                <img loading="lazy" width="1200" height="494"
                  src="https://cool.devo.build/tutorials/oci-iac-framework/assets/dbcs_overview.png"
                  data-original="https://cool.devo.build/tutorials/oci-iac-framework/assets/dbcs_overview.png"
                  data-at2x="https://cool.devo.build/tutorials/oci-iac-framework/assets/dbcs_overview@2x.png"
                  title="Database System Overview" alt="Database System Overview" />
              </picture>
              <figcaption>Database System Overview</figcaption>
            </figure>

            <p>The Oracle Database Cloud Service offers autonomous and co-managed Oracle Database cloud solutions.
              Autonomous databases are preconfigured, fully-managed environments that are suitable for either
              transaction processing or for data warehouse workloads. Co-managed solutions are virtual machine and
              Exadata DB systems that you can customize with the resources and settings that meet your needs.</p>

            <p>You can quickly provision an Autonomous Database or co-managed DB system. You have full access to the
              features and operations available with the database, but Oracle owns and manages the infrastructure.</p>

            <p>You can also extend co-managed database services into your data center by using Exadata Cloud@Customer,
              which applies the combined power of Exadata and Oracle Cloud Infrastructure while enabling you to meet
              your organization’s data-residency requirements.</p>

            <p>For details about each offering, start with the following overview topics:</p>

            <p><strong>Autonomous Databases</strong></p>

            <p>The Database service offers Oracle’s <a
                href="https://docs.oracle.com/en-us/iaas/Content/Database/Concepts/adboverview.htm#Overview_of_Autonomous_Databases?source=:ex:tb:::::WWMK211201P00070:WW_FY22_DevRel_DotBuild&SC=:ex:tb:::::WWMK211201P00070:WW_FY22_DevRel_DotBuild&pcode=WWMK211201P00070">Autonomous
                Databases</a> with transaction processing and data warehouse workload types.</p>

            <p><strong>Co-managed Systems</strong></p>

            <ul>
              <li><a
                  href="https://docs.oracle.com/en-us/iaas/Content/Database/Concepts/overview.htm#Bare?source=:ex:tb:::::WWMK211201P00070:WW_FY22_DevRel_DotBuild&SC=:ex:tb:::::WWMK211201P00070:WW_FY22_DevRel_DotBuild&pcode=WWMK211201P00070">Virtual
                  Machine DB Systems</a></li>
              <li><a
                  href="https://docs.oracle.com/en-us/iaas/Content/Database/Concepts/exaoverview.htm#Exadata_DB_Systems?source=:ex:tb:::::WWMK211201P00070:WW_FY22_DevRel_DotBuild&SC=:ex:tb:::::WWMK211201P00070:WW_FY22_DevRel_DotBuild&pcode=WWMK211201P00070">Exadata
                  Cloud Service</a></li>
              <li><a
                  href="https://docs.oracle.com/en-us/iaas/exadata/index.html?source=:ex:tb:::::WWMK211201P00070:WW_FY22_DevRel_DotBuild&SC=:ex:tb:::::WWMK211201P00070:WW_FY22_DevRel_DotBuild&pcode=WWMK211201P00070">Exadata
                  Cloud@Customer</a></li>
            </ul>

            <h2 id="database-cloud-service-on-virtual-machine">Database Cloud Service on Virtual Machine</h2>

            <p>Database Cloud Service offers full-featured Oracle Database cloud instances:</p>

            <ul>
              <li>Enterprise Edition or Standard Edition 2</li>
              <li>Multiple Oracle Database versions, including <a
                  href="https://blogs.oracle.com/database/post/introducing-oracle-database-21c?source=:ex:tb:::::WWMK211201P00070:WW_FY22_DevRel_DotBuild&SC=:ex:tb:::::WWMK211201P00070:WW_FY22_DevRel_DotBuild&pcode=WWMK211201P00070">21c</a>
              </li>
              <li>4 tiers of Oracle Database License Included options or Bring Your Own License</li>
              <li>Enhanced with Cloud automation features</li>
            </ul>

            <p>In addition to our Oracle Database Cloud Solution (DBCS) we also offer managed MySQL Cloud Services and
              other Data Management Cloud Services.</p>

            <h3 id="cloud-automation-under-customer-control---provisioning-patching-backup-disaster-recovery">Cloud
              automation under customer control - provisioning, patching, backup, disaster recovery</h3>

            <figure class="aligncenter">
              <picture>
                <source srcset="https://cool.devo.build/tutorials/oci-iac-framework/assets/dbcs_features.png 1x" />
                <img loading="lazy" width="1200" height="737"
                  src="https://cool.devo.build/tutorials/oci-iac-framework/assets/dbcs_features.png"
                  data-original="https://cool.devo.build/tutorials/oci-iac-framework/assets/dbcs_features.png"
                  data-at2x="https://cool.devo.build/tutorials/oci-iac-framework/assets/dbcs_features@2x.png"
                  title="DBCS Features" alt="DBCS Features" />
              </picture>
              <figcaption>DBCS Features</figcaption>
            </figure>

            <h1 id="database-cloud-service-provisioning-using-terraform-and-oci-resource-manager">Database Cloud Service
              Provisioning using Terraform and OCI Resource Manager</h1>

            <p>Database Cloud Service on VM is an exceptional entry into the world of cloud-supported database services.
              First, you keep full control of your database servers and databases, plus the service includes many
              convenience functions, which simplify and accelerate the creation and configuration of database systems.
              Furthermore, with a few clicks your database can be enhanced with more features to accommodate growing
              demands or required adjustments. This includes CPU and storage scaling, or the creation of a standby
              database through Data Guard.</p>

            <p>When creating a Database Cloud Service on VM all the cloud resources you need to get a fully operational
              database instance going are provisioned:</p>

            <ul>
              <li>Compute instance instantiates a Real Application Cluster (RAC)</li>
              <li>Block storage is made available to the database nodes</li>
              <li>Object Store is used to store automated and manual backups</li>
            </ul>

            <blockquote class="notice">
              <p><strong>Note:</strong> All DBCS resources are only accessible through the Database System resource, not
                through the individual categories as Compute Instances or Object Store.</p>
            </blockquote>

            <blockquote class="notice">
              <p><strong>Note:</strong> All DBCS components are created as part of the Database System resource.
                Therefore you won’t find them under the Compute Instance or Object Storage Categories in the OCI
                console.</p>
            </blockquote>

            <h2 id="prepare-the-ocloud-landing-zone">Prepare the OCloud Landing Zone</h2>

            <p>Before we create a DBCS on VM resource, we’ll set up a Compartment, a Virtual Cloud Network (VCN), and a
              Subnet. You can do this through the OCI console or Terraform, using OCI’s Rest API. The latter method is
              used for this session.</p>

            <p>Instructions on how to deploy OCloud Landing Zone can be found <a
                href="https://github.com/oracle-devrel/terraform-oci-ocloud-landing-zone">here</a>.</p>

            <figure class="aligncenter">
              <picture>
                <source
                  srcset="https://cool.devo.build/tutorials/oci-iac-framework/assets/ocloud_dbcs_architecture.png 1x" />
                <img loading="lazy" width="1200" height="648"
                  src="https://cool.devo.build/tutorials/oci-iac-framework/assets/ocloud_dbcs_architecture.png"
                  data-original="https://cool.devo.build/tutorials/oci-iac-framework/assets/ocloud_dbcs_architecture.png"
                  data-at2x="https://cool.devo.build/tutorials/oci-iac-framework/assets/ocloud_dbcs_architecture@2x.png"
                  title="DBCS Architecture" alt="DBCS Architecture" />
              </picture>
              <figcaption>DBCS Architecture</figcaption>
            </figure>

            <p>Policies for the Database Compartment allow members of the dbops group to create database subnets and to
              manage database-family resources:</p>

            <div class="language-sql highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><span class="o">-</span>	<span class="n">ALLOW</span> <span class="k">GROUP</span> <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">_dbops</span> <span class="n">manage</span> <span class="k">database</span><span class="o">-</span><span class="n">family</span> <span class="k">in</span> <span class="n">compartment</span> <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">_database_compartment</span>
<span class="o">-</span>	<span class="n">ALLOW</span> <span class="k">GROUP</span> <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">_dbops</span> <span class="k">read</span> <span class="k">all</span><span class="o">-</span><span class="n">resources</span> <span class="k">in</span> <span class="n">compartment</span> <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">_database_compartment</span>
<span class="o">-</span>	<span class="n">ALLOW</span> <span class="k">GROUP</span> <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">_dbops</span> <span class="n">manage</span> <span class="n">subnets</span> <span class="k">in</span> <span class="n">compartment</span> <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">_database_compartment</span>
</code></pre>
              </div>
            </div>

            <h2 id="ocloud-remote-stack">OCloud Remote Stack</h2>

            <p>Now, to create the database system resource OCI Rest API requires a target compartment and a target
              subnet. There are three different ways to collect information in OCI:</p>

            <ul>
              <li>The Terraform stack defines the required parameters as default values, or they are entered by the user
                when the stack is created in OCI Resource Manager (ORM)</li>
              <li>Database Compartment OCID and VNC OCID are queried from OCI as data elements:</li>
            </ul>

            <div class="language-terraform highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><span class="c1"># In this example a list of all compartments within a Tenant is returned which is filtered by the database compartment name</span>
<span class="k">data</span> <span class="s2">"oci_identity_compartments"</span> <span class="s2">"db_compartment"</span> <span class="p">{</span>
   <span class="nx">compartment_id</span> <span class="p">=</span> <span class="err">&lt;</span><span class="nx">tenancy_ocid</span><span class="err">&gt;</span>
   <span class="nx">compartment_id_in_subtree</span> <span class="p">=</span> <span class="kc">true</span>
   <span class="nx">state</span>          <span class="p">=</span> <span class="s2">"ACTIVE"</span>
   <span class="nx">filter</span> <span class="p">{</span>
      <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"name"</span>
      <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span> <span class="err">&lt;</span><span class="nx">Datenbank</span> <span class="nx">Compartment</span> <span class="nx">Name</span><span class="err">&gt;</span> <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre>
              </div>
            </div>

            <ul>
              <li>Terraform supports direct access to the output data of previously provisioned stacks through
                oci_resourcemanager_stack_tf_stat and terraform_remote_state resources. For this object-relational
                mapping (ORM) Terraform extracts the desired information from the terraform tfstate file which is stored
                as part of a successfully deployed OCI Stack.</li>
            </ul>

            <div class="language-terraform highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><span class="k">data</span> <span class="s2">"oci_resourcemanager_stack_tf_state"</span> <span class="s2">"stack1_tf_state"</span> <span class="p">{</span>
   <span class="nx">stack_id</span>   <span class="p">=</span> <span class="err">&lt;</span><span class="nx">stack</span> <span class="nx">id</span><span class="err">&gt;</span>
   <span class="nx">local_path</span> <span class="p">=</span> <span class="s2">"stack1.tfstate"</span>
<span class="p">}</span>

<span class="c1"># Load the pulled state file into a remote state data source</span>
<span class="k">data</span> <span class="s2">"terraform_remote_state"</span> <span class="s2">"external_stack_remote_state"</span> <span class="p">{</span>
   <span class="nx">backend</span> <span class="p">=</span> <span class="s2">"local"</span>
   <span class="nx">config</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">path</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${data</span><span class="p">.</span><span class="nx">oci_resourcemanager_stack_tf_state</span><span class="p">.</span><span class="nx">stack1_tf_state</span><span class="p">.</span><span class="nx">local_path</span><span class="k">}</span><span class="s2">"</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre>
              </div>
            </div>

            <p>In real-life, several of these methods will likely be used in combination.</p>

            <h2 id="creating-the-database-subnet">Creating the Database Subnet</h2>

            <p>After validating the prerequisites for a DBCS on VM deployment, now we’ll provision the resources for the
              DBCS on VM stack.</p>

            <p>For this use case all members of the dbops group should be able to create subnets and database resources
              within the Tenant’s Database Compartment’s limits. For creating subnets, we use a dedicated Terraform
              module that is provided by the terraform-oci-ocloud-landing-zone repository.</p>

            <p><a
                href="https://github.com/oracle-devrel/terraform-oci-ocloud-landing-zone/tree/main/component/network_domain">https://github.com/oracle-devrel/terraform-oci-ocloud-landing-zone/tree/main/component/network_domain</a>
            </p>

            <p>The network_domain module, which is also used as part of the landing zone provisioning, creates a private
              subnet and all required Security List Policies to communicate with the database system.</p>

            <p>When sizing the subnet, you should pay attention to the minimum required IP addresses for a certain
              deployment type (single node vs RAC). The OCloud landing zone defines the bigger subnets for each service,
              but if the database architecture demands more as one big subnet, the Terraform function
              cidrsubnet(prefix,newbits,netum) allows you to split the address space into smaller chunks</p>

            <table>
              <thead>
                <tr>
                  <th>service_segment_subnets</th>
                  <th>key subnet</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>app</td>
                  <td>10.0.0.0/26</td>
                </tr>
                <tr>
                  <td>db</td>
                  <td>10.0.0.64/26</td>
                </tr>
                <tr>
                  <td>pres</td>
                  <td>10.0.1.0/26</td>
                </tr>
                <tr>
                  <td>k8s</td>
                  <td>10.0.0.128/25</td>
                </tr>
              </tbody>
            </table>

            <p>Below you can see an example where CIDIR block 10.0.0.64/26 is split into four subnets by adding two
              additional bits (newbits).</p>

            <div class="language-plaintext highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code>&gt; cidrsubnets("10.0.0.64/26",2,2,2,2)
 tolist([
   "10.0.0.64/28",  ---&gt;  cidrsubnet("10.0.0.64/26",2,0)
   "10.0.0.80/28",  ---&gt;  cidrsubnet("10.0.0.64/26",2,1)
    "10.0.0.96/28",  ---&gt;  cidrsubnet("10.0.0.64/26",2,2)
   "10.0.0.112/28",  ---&gt;  cidrsubnet("10.0.0.64/26",2,3)
])
</code></pre>
              </div>
            </div>

            <p>The Terraform module network_domain creates a private subnet for a given database compartment and VNC. It
              also sets all ingress rules to allow ssh to the Database nodes and to communicate with the database
              itself. Last but not least, it sets all egress rules to access Object Storage and YUM Repository on the
              Service Network.</p>

            <p>The db_domain module doesn’t define its own Bastion Service as this is available through the application
              subnet however, after provisioning the database, a couple of Bastion Sessions are created (ssh, sqlnet)
              aiming to validate database system connectivity. Once the Time-to-Live has exceeded the Bastion Sessions
              it will be terminated automatically.</p>

            <p><strong>Resource Schema</strong></p>

            <div class="language-terraform highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><span class="k">module</span> <span class="s2">"db_domain"</span> <span class="p">{</span>
  <span class="err">…</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"github.com/oracle-devrel/terraform-oci-ocloud-landing-zone/component/network_domain"</span>
  <span class="nx">config</span>  <span class="p">=</span> <span class="p">{</span>
    <span class="nx">service_id</span>     <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Container</span> <span class="nx">Compartment</span> <span class="nx">ID</span><span class="err">&gt;</span>
    <span class="nx">compartment_id</span> <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Database</span> <span class="nx">Compartment</span> <span class="nx">ID</span><span class="err">&gt;</span>
    <span class="nx">vcn_id</span>         <span class="p">=</span> <span class="err">&lt;</span><span class="nx">VNC</span> <span class="nx">ID</span><span class="err">&gt;</span>
    <span class="nx">anywhere</span>       <span class="p">=</span> <span class="err">“</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">0</span><span class="err">”</span>
    <span class="nx">defined_tags</span>   <span class="p">=</span> <span class="kc">null</span>
    <span class="nx">freeform_tags</span>  <span class="p">=</span> <span class="p">{</span><span class="s2">"framework"</span> <span class="p">=</span> <span class="s2">"ocloud"</span><span class="p">}</span>
  <span class="p">}</span>
  <span class="c1"># Subnet Requirements</span>
  <span class="c1"># DB System Type, # Required IP Addresses, Minimum Subnet Size</span>
  <span class="c1"># 1-node virtual machine, 1 + 3 reserved in subnet = 4, /30 (4 IP addresses)</span>
  <span class="c1"># 2-node RAC virtual machine, (2 addresses * 2 nodes) + 3 for SCANs + 3 reserved in subnet = 10, /28 (16 IP addresses)</span>
  <span class="nx">subnet</span>  <span class="p">=</span> <span class="p">{</span>
    <span class="c1"># Select the predefined name per index</span>
    <span class="nx">domain</span>                      <span class="p">=</span> <span class="err">&lt;</span><span class="nx">predefined</span> <span class="nx">subnet</span> <span class="nx">postfix</span> <span class="p">(</span><span class="nx">See</span> <span class="nx">OCloud</span> <span class="nx">Landing</span> <span class="nx">Zone</span><span class="p">,</span> <span class="k">module</span> <span class="nx">service_segment</span><span class="p">)</span><span class="err">&gt;</span>
    <span class="c1"># Select the predefined range per index</span>
    <span class="nx">cidr_block</span>                  <span class="p">=</span> <span class="err">&lt;</span><span class="nx">predefined</span> <span class="nx">subnet</span> <span class="nx">cidr</span> <span class="nx">block</span> <span class="p">(</span><span class="nx">See</span> <span class="nx">OCloud</span> <span class="nx">Landing</span> <span class="nx">Zone</span><span class="p">,</span> <span class="k">module</span> <span class="nx">service_segment</span><span class="p">)</span><span class="err">&gt;&gt;</span>
    <span class="c1"># Create subnet as private</span>
    <span class="nx">prohibit_public_ip_on_vnic</span>  <span class="p">=</span> <span class="kc">true</span> <span class="c1"># Creates a private subnet</span>
    <span class="nx">dhcp_options_id</span>             <span class="p">=</span> <span class="kc">null</span>
    <span class="nx">route_table_id</span>              <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Routing</span> <span class="nx">Table</span> <span class="nx">ID</span> <span class="nx">for</span> <span class="nx">Oracle</span> <span class="nx">Service</span> <span class="nx">Network</span> <span class="nx">connectivity</span> <span class="nx">which</span> <span class="nx">is</span> <span class="nx">created</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">OCloud</span> <span class="nx">Landing</span> <span class="nx">Zone</span><span class="err">&gt;</span>
  <span class="err">}</span>
  <span class="nx">bastion</span>  <span class="p">=</span> <span class="p">{</span>
    <span class="nx">create</span>            <span class="p">=</span> <span class="kc">false</span> <span class="c1"># Determine whether a bastion service will be deployed and attached</span>
    <span class="nx">client_allow_cidr</span> <span class="p">=</span> <span class="p">[]</span>
    <span class="nx">max_session_ttl</span>   <span class="p">=</span> <span class="kc">null</span>
  <span class="p">}</span>
  <span class="c1"># Security List Policies</span>
  <span class="nx">tcp_ports</span> <span class="p">=</span> <span class="p">{</span>
    <span class="c1">// [protocol, source_cidr, destination port min, max]</span>
    <span class="nx">ingress</span> <span class="p">=</span> <span class="p">[</span>
      <span class="p">[</span><span class="s2">"ssh"</span><span class="p">,</span> <span class="err">“</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">0</span><span class="err">”</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">],</span> <span class="c1"># DBnode access</span>
      <span class="p">[</span><span class="s2">"http"</span><span class="p">,</span> <span class="err">“</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">0</span><span class="err">”</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span> <span class="c1"># APEX access</span>
      <span class="p">[</span><span class="s2">"https"</span><span class="p">,</span> <span class="err">“</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">0</span><span class="err">”</span><span class="p">,</span> <span class="mi">443</span><span class="p">,</span> <span class="mi">443</span><span class="p">],</span> <span class="c1"># APEX access</span>
      <span class="p">[</span><span class="s2">"tcp"</span><span class="p">,</span> <span class="err">“</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">0</span><span class="err">”</span><span class="p">,</span> <span class="mi">1521</span><span class="p">,</span> <span class="mi">1522</span><span class="p">],</span> <span class="c1"># DB Access where 1521 is used for DBCS and 1522 for Autonomous DB</span>
      <span class="p">[</span><span class="s2">"tcp"</span><span class="p">,</span> <span class="err">“</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">0</span><span class="err">”</span><span class="p">,</span> <span class="mi">5500</span><span class="p">,</span> <span class="mi">5500</span><span class="p">],</span> <span class="c1"># Enterprise Manager Express access</span>
      <span class="p">[</span><span class="s2">"tcp"</span><span class="p">,</span> <span class="err">“</span><span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">0</span><span class="err">”</span><span class="p">,</span> <span class="mi">6200</span><span class="p">,</span> <span class="mi">6200</span><span class="p">]</span> <span class="c1"># Enables the Oracle Notification Services (ONS) to communicate about Fast Application Notification (FAN) events</span>
    <span class="p">]</span>
  <span class="p">}</span>
</code></pre>
              </div>
            </div>

            <h2 id="database-system-provisioning">Database System Provisioning</h2>

            <p>Now that all our prerequisite resources are created, we’re ready to set up the final components. The OCI
              resource oci_database_db_system provisions a database system, database nodes, and an initial CDB and PDB
              all in one step. Convenient, no? Note that oci_database_db_system comes with many additional parameters to
              support other flavors of provisioning a database, i.e., to create a database instance from a backup or as
              clone from an existing database system. For this scenario we’ll focus on a fresh database install. Refer
              to oci_database_db_system resource documentation for further details.</p>

            <div class="language-terraform highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><span class="k">resource</span> <span class="s2">"oci_database_db_system"</span> <span class="s2">"dbaas_db_system"</span> <span class="p">{</span>
  <span class="nx">availability_domain</span> <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Availibility</span> <span class="nx">Domain</span><span class="err">&gt;</span>
  <span class="nx">compartment_id</span>      <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Database</span> <span class="nx">Compartment</span><span class="err">&gt;</span>
  <span class="nx">database_edition</span>    <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Database</span> <span class="nx">Edition</span><span class="p">,</span> <span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.</span> <span class="nx">ENTERPRISE</span> <span class="nx">EDITION</span><span class="err">&gt;</span>

  <span class="nx">db_home</span> <span class="p">{</span>
    <span class="nx">database</span> <span class="p">{</span>
      <span class="nx">admin_password</span> <span class="p">=</span> <span class="err">&lt;</span><span class="nx">SYS</span> <span class="nx">PASSWORD</span><span class="err">&gt;</span>
      <span class="nx">db_name</span>        <span class="p">=</span> <span class="err">&lt;</span><span class="nx">CDB</span> <span class="nx">Name</span><span class="err">&gt;</span>
      <span class="nx">character_set</span>  <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Character</span> <span class="nx">Set</span><span class="err">&gt;</span>
      <span class="nx">ncharacter_set</span> <span class="p">=</span> <span class="err">&lt;</span><span class="nx">International</span> <span class="nx">Character</span> <span class="nx">Set</span><span class="err">&gt;</span>
      <span class="nx">db_workload</span>    <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Workload</span> <span class="nx">Type</span><span class="p">,</span> <span class="nx">OLTP</span> <span class="nx">or</span> <span class="nx">DW</span><span class="err">&gt;</span>
      <span class="nx">pdb_name</span>       <span class="p">=</span> <span class="err">&lt;</span><span class="nx">PDB</span> <span class="nx">Name</span><span class="err">&gt;</span>
      <span class="nx">tde_wallet_password</span> <span class="p">=</span> <span class="err">&lt;</span><span class="nx">TDE</span> <span class="nx">Wallet</span> <span class="nx">Password</span> <span class="nx">if</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">different</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">admin_password</span><span class="err">&gt;</span>

      <span class="nx">db_backup_config</span> <span class="p">{</span>
        <span class="nx">auto_backup_enabled</span> <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Is</span> <span class="nx">automated</span> <span class="nx">backup</span> <span class="nx">to</span> <span class="nx">Object</span> <span class="nx">Storage</span> <span class="nx">enabled</span><span class="err">?&gt;</span>
        <span class="nx">auto_backup_window</span> <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Two</span> <span class="nx">hour</span> <span class="nx">time</span> <span class="nx">slot</span> <span class="nx">within</span> <span class="mi">24</span> <span class="nx">hour</span> <span class="nx">when</span> <span class="nx">the</span> <span class="nx">backup</span> <span class="nx">can</span> <span class="nx">take</span> <span class="nx">place</span><span class="err">&gt;</span>
        <span class="nx">recovery_window_in_days</span> <span class="err">=</span> <span class="err">&lt;</span><span class="nx">Retention</span> <span class="nx">Period</span><span class="err">&gt;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">db_version</span>   <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Database</span> <span class="nx">Version</span><span class="p">,</span> <span class="nx">whereas</span> <span class="mf">19.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">0</span> <span class="nx">corresponds</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">latest</span> <span class="nx">available</span> <span class="nx">version</span><span class="err">,</span> <span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.</span> <span class="mf">19.12</span><span class="p">.</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">0</span>
    <span class="nx">display_name</span> <span class="p">=</span> <span class="err">&lt;&gt;</span>
  <span class="nx">shape</span>           <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Database</span> <span class="nx">Node</span> <span class="nx">Shape</span> <span class="nx">which</span> <span class="nx">defines</span> <span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">OCPUs</span> <span class="nx">and</span> <span class="nx">Memory</span><span class="err">&gt;</span>
  <span class="nx">subnet_id</span>       <span class="err">=</span> <span class="err">&lt;</span><span class="nx">Target</span> <span class="nx">Database</span> <span class="nx">Subnet</span><span class="err">&gt;</span>
  <span class="nx">ssh_public_keys</span> <span class="p">=</span> <span class="p">[</span><span class="err">&lt;</span><span class="nx">Public</span> <span class="nx">Key</span> <span class="nx">for</span> <span class="nx">ssh</span> <span class="nx">access</span><span class="err">&gt;</span><span class="p">]</span>
  <span class="nx">display_name</span>    <span class="p">=</span> <span class="err">&lt;</span><span class="nx">OCI</span> <span class="nx">Display</span> <span class="nx">Name</span><span class="err">&gt;</span>
  <span class="nx">hostname</span>                <span class="p">=</span> <span class="err">&lt;</span><span class="nx">DB</span> <span class="nx">Node</span> <span class="nx">Hostname</span> <span class="nx">Prefix</span><span class="err">&gt;</span>
  <span class="nx">data_storage_size_in_gb</span> <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Initial</span> <span class="nx">Database</span> <span class="nx">Storage</span><span class="err">&gt;</span>
  <span class="nx">license_model</span>           <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Database</span> <span class="nx">License</span> <span class="nx">is</span> <span class="nx">either</span> <span class="nx">included</span> <span class="nx">or</span> <span class="nx">transferred</span> <span class="nx">from</span> <span class="nx">On</span> <span class="nx">Premise</span> <span class="err">&gt;</span>
  <span class="nx">node_count</span>              <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Database</span> <span class="nx">Node</span> <span class="nx">Count</span><span class="p">,</span> <span class="mi">1</span> <span class="nx">or</span> <span class="mi">2</span> <span class="nx">for</span> <span class="nx">a</span> <span class="nx">Real</span> <span class="nx">Application</span> <span class="nx">Cluster</span><span class="err">&gt;</span>
  <span class="nx">cluster_name</span>            <span class="p">=</span> <span class="err">&lt;</span><span class="nx">RAC</span> <span class="nx">Cluster</span> <span class="nx">name</span><span class="err">&gt;</span>
  <span class="nx">nsg_ids</span>                 <span class="p">=</span> <span class="err">&lt;</span><span class="nx">Optional</span> <span class="nx">Network</span> <span class="nx">Security</span> <span class="nx">Group</span><span class="err">&gt;</span>
  <span class="nx">db_system_options</span> <span class="p">{</span>
   	<span class="nx">storage_management</span> <span class="p">=</span> <span class="err">&lt;</span><span class="nx">LVM</span> <span class="nx">or</span> <span class="nx">ASM</span><span class="err">&gt;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
              </div>
            </div>

            <h2 id="oci-resource-manager">OCI Resource Manager</h2>

            <p>To use DBCS on VM stack with Resource Manager you need to either download the code as zip-file from <a
                href="https://github.com/oracle-devrel/terraform-oci-ocloud-db/tree/main">https://github.com/oracle-devrel/terraform-oci-ocloud-db/tree/main</a>,
              click “Deploy to Oracle Cloud” within the Github repository’s <a
                href="https://github.com/oracle-devrel/terraform-oci-ocloud-db/blob/updates/README.md">Readme</a> or
              create your own cloned repository on Gitlab or Github. Note that DBCS stack <a
                href="https://github.com/oracle-devrel/terraform-oci-ocloud-landing-zone/tree/main/component/network_domain">references</a>
              so if you are using a customized version of the landing zone stack you might have to update the “source”
              parameter of the db_domain module.</p>

            <p>For this session we’ll pick “Deploy to Cloud” from the stack’s Readme. It automatically redirects you to
              OCI Console login and after authentication, opens Resource Manager. “Package URL” points to the stack
              artifact which is stored within the Github repository. Confirm the “Terms of Use.”</p>

            <p>Now, let’s enter a meaningful name for your DBCS stack and choose a Compartment where your stack resource
              will be created. Note that the stack compartment may differ from the Compartment where the actual
              infrastructure resources reside.</p>

            <p>On the next page you’ll finalize the database system configuration. Enter the landing zone’s Stack OCID,
              which can be found in Resource Manager next to the landing zone stack. This avoids the need to re-enter a
              lot of the parameters and enables access to Output artifacts from the landing zone.</p>

            <p>Enter a Database System display name. Accept the shown default values, or adjust them to you needs. For a
              default deployment the following values are used:</p>

            <table>
              <thead>
                <tr>
                  <th>Configuration</th>
                  <th>Database Version</th>
                  <th>Oracle Database Software Edition</th>
                  <th>Shape</th>
                  <th>OCPUs</th>
                  <th>Storage(GB)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Small</td>
                  <td>19c</td>
                  <td>Oracle Enterprise Edition</td>
                  <td>VM.Standard2.2</td>
                  <td>2</td>
                  <td>512</td>
                </tr>
              </tbody>
            </table>

            <table>
              <thead>
                <tr>
                  <th>Deployment Type</th>
                  <th>Storage Management Software</th>
                  <th>Auto Backup enabled?</th>
                  <th>Node Count</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Fast Provisioning</td>
                  <td>LVM</td>
                  <td>false</td>
                  <td>1</td>
                </tr>
              </tbody>
            </table>

            <p>Finally enter the admin or sys password and the public part of your ssh key. Make sure you update the
              admin password after installation as the initial password will show up in the Terraform tfstate file.</p>

            <p>Another way to preconfigure parameters is to manually download the Terraform code from repository and add
              a terraform.tfvars file. The respective values are shown as read-only parameters in the stack
              configuration.</p>

            <p>Example:</p>

            <div class="language-terraform highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><span class="nx">db_system_display_name</span> <span class="err">=</span> <span class="s2">"OCI Database System Display Name"</span>
<span class="nx">db_system_ssh_public_keys</span> <span class="err">=</span> <span class="s2">"ssh-rsa …"</span>
<span class="nx">db_system_db_home_database_admin_password</span> <span class="err">=</span> <span class="s2">"Password"</span>
<span class="nx">stack_id</span> <span class="err">=</span> <span class="s2">"ocid1.ormstack.oc1.eu-frankfurt-1.aaaaaaaaqyekvuodrozodmn23zxi…"</span>
</code></pre>
              </div>
            </div>

            <p>OCloud DBCS on VM Stack supports other ways to deploy a database system, but they’re not the subject of
              this session:</p>

            <ul>
              <li>Deploy a Database System into an existing subnet</li>
              <li>Overwrite Organization, Project and Environment labels which were defined by the corresponding OCloud
                Landing Zone</li>
              <li>Customize all stack parameters</li>
            </ul>

            <p>For further information refer to the OCloud DBCS on VM stack’s <a
                href="https://github.com/oracle-devrel/terraform-oci-ocloud-db/blob/updates/README.md">Readme</a>.</p>

            <h3 id="plan-but-dont-apply">Plan but don’t apply</h3>

            <p>Create the stack but don’t check “Run Apply” because you should plan your deployment first. This step is
              very important as it validates to see if the stack code contains any syntax errors, and exactly which OCI
              resources are going to be added, updated, or destroyed. OCI resources contain updateable and
              non-updateable parameters, therefore it is recommended to make the planning task a routine as updating a
              non-updateable value may result in destruction of the resource:</p>

            <div class="language-plaintext highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code>Plan: 9 to add, 0 to change, 0 to destroy.
</code></pre>
              </div>
            </div>

            <p>After verifying the expected results, the stack can be applied. For a “Small” configuration and “Fast
              Provisioning” it can take between 20 to 25 minutes until the database is available.</p>

            <h3 id="verify-db-node-and-database-access">Verify DB Node and Database access</h3>

            <p>Once Database System, Container Database, and Pluggable Database are available you can verify
              connectivity. Our target resource is in a private subnet; therefore, the Apps Compartments Bastion Service
              needs to be used as the Bastion Sessions were created as part of the DBCS stack.</p>

            <table>
              <thead>
                <tr>
                  <th>Protocol</th>
                  <th>Session type</th>
                  <th>IP Address</th>
                  <th>Port</th>
                  <th>Maximum session time-to-live (min)</th>
                  <th> </th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ssh</td>
                  <td>SSH Port Forwarding Session</td>
                  <td>Host IP</td>
                  <td>22</td>
                  <td>1800</td>
                  <td>ssh access to database node(s)</td>
                </tr>
                <tr>
                  <td>sqlnet</td>
                  <td>SSH Port Forwarding Session</td>
                  <td>Host IP</td>
                  <td>1521</td>
                  <td>1800</td>
                  <td>sqlplus, sqlcl or sqldeveloper</td>
                </tr>
              </tbody>
            </table>

            <p><strong>SSH:</strong></p>

            <p>Copy the SSH command from OCI console (Bastion Session) to create an SSH tunnel from <code
                class="language-plaintext highlighter-rouge">localhost:localport</code> to <code
                class="language-plaintext highlighter-rouge">&lt;database node ip address&gt;:22</code>.</p>

            <div class="language-console highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><span class="gp">ssh -i &lt;private key file path&gt;</span><span class="w"> </span><span class="nt">-N</span> <span class="nt">-L</span> &lt;<span class="nb">local </span>port&gt;:&lt;database node ip address&gt;:22 <span class="nt">-p</span> 22 &lt;bastion session OCID&gt;@host.bastion.eu-frankfurt-1.oci.oraclecloud.com
</code></pre>
              </div>
            </div>

            <p>To ssh to the DB Node use the following command:</p>

            <div class="language-console highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><span class="gp">ssh -i &lt;private key file&gt;</span><span class="w"> </span>opc@localhost <span class="nt">-p</span> &lt;<span class="nb">local </span>port&gt;
</code></pre>
              </div>
            </div>

            <p><strong>Oracle SQL Developer:</strong></p>

            <p>For an Oracle SQL Developer connection to either the CDB or PDB, copy the SSH command from OCI console
              (Bastion Session) to create an ssh tunnel from <code
                class="language-plaintext highlighter-rouge">localhost:localport</code> to <code
                class="language-plaintext highlighter-rouge">&lt;database node ip address&gt;:1521</code>.</p>

            <div class="language-console highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><span class="gp">ssh -i &lt;private key file&gt;</span><span class="w"> </span><span class="nt">-N</span> <span class="nt">-L</span> &lt;<span class="nb">local </span>port&gt;:&lt;database node ip address&gt;:1521 <span class="nt">-p</span> 22 &lt;bastion session OCID&gt;@host.bastion.eu-frankfurt-1.oci.oraclecloud.com
</code></pre>
              </div>
            </div>

            <p>Open sqldeveloper and create a new database connection:</p>

            <table>
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Value</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Username</td>
                  <td>sys</td>
                </tr>
                <tr>
                  <td>Password</td>
                  <td>admin password</td>
                </tr>
                <tr>
                  <td>Role</td>
                  <td>SYSDBA</td>
                </tr>
                <tr>
                  <td>Connection Type</td>
                  <td>Basic</td>
                </tr>
                <tr>
                  <td>Hostname</td>
                  <td>localhost</td>
                </tr>
                <tr>
                  <td>Port</td>
                  <td>[local sql port]</td>
                </tr>
                <tr>
                  <td>Service Name</td>
                  <td>CDB or PDB SERVICE_NAME from DBCS output</td>
                </tr>
              </tbody>
            </table>

            <p><strong>SQLcl and SQLplus</strong></p>

            <p>For a sqlcl or sqlplus connection, copy the SSH command from OCI console (Bastion Session) to create a
              SSH tunnel from <code class="language-plaintext highlighter-rouge">localhost:localport</code> to <code
                class="language-plaintext highlighter-rouge">&lt;database node ip address&gt;:1521</code>.</p>

            <div class="language-console highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><span class="gp">ssh -i &lt;private key file&gt;</span><span class="w"> </span><span class="nt">-N</span> <span class="nt">-L</span> &lt;<span class="nb">local </span>port&gt;:&lt;database node ip address&gt;:1521 <span class="nt">-p</span> 22 &lt;bastion session OCID&gt;@host.bastion.eu-frankfurt-1.oci.oraclecloud.com
</code></pre>
              </div>
            </div>
            <p>Execute</p>

            <div class="language-console highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><span class="gp">sql sys@localhost:1523/&lt;FQ Database Name&gt;</span><span class="w"> </span>AS sysdba
<span class="go">or
</span><span class="gp">sqlplus sys@&lt;FQ Database Name&gt;</span><span class="w"> </span>AS sysdba
</code></pre>
              </div>
            </div>

            <p>And now you’ve logged into the database, congratulations!</p>

            <h2 id="conclusion">Conclusion</h2>

            <p>We successfully provisioned a Database Cloud Service on VM Database instance. From here, you can apply
              further adjustments or add additional stacks to your OCI Infrastructure in your Tenancy.</p>

            <p>Happy building!</p>


          </div>
        </section>
        <!-- /CC01v0 -->

      </main>
    </div>
  </div>
</section>
<!-- /F19v0 -->